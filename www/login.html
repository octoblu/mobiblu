<html>
    <head>
        <!-- cordova.js is served from localhost to ensure the correct version -->
        <script id="ag-cordova-loader" src="http://localhost/cordova.js"></script>

        <script src="/components/steroids-js/steroids.js"></script>
        <script src="/components/steroids-addons/index.js"></script>

        <script type="text/javascript">

            (function(){

                function getParam(variable) {
                    var query = window.location.search.substring(1);
                    var vars = query.split("&");
                    for (var i = 0; i < vars.length; i++) {
                        var pair = vars[i].split("=");
                        if (pair[0] == variable) {
                            return pair[1];
                        }
                    }
                    return false;
                }

                var newskynetuuid = getParam('uuid'),
                        newskynettoken = getParam('token'),
                        skynetuuid = window.localStorage.getItem('skynetuuid'),
                        skynettoken = window.localStorage.getItem('skynettoken');

                var invalidLogin = false;
                if (newskynetuuid === 'undefined') {
                    newskynetuuid = null;
                    invalidLogin = true;
                }
                if (newskynettoken === 'undefined') {
                    newskynettoken = null;
                    invalidLogin = true;
                }

                console.log('Skynet UUID', skynetuuid);
                console.log('Skynet Token', skynettoken);
                console.log('NEW Skynet UUID', newskynetuuid);
                console.log('NEW Skynet Token', newskynettoken);
                // Set new Skynet Tokens
                if (newskynetuuid && newskynettoken) {
                    console.log('Setting new credentials');
                    // If user changed then do delete the mobileuuid && mobiletoken
                    if(skynetuuid && skynetuuid !== newskynetuuid){
                        console.log('Setting new mobile credentials');
                        window.localStorage.removeItem("mobileuuid");
                        window.localStorage.removeItem("mobiletoken");
                    }
                    window.localStorage.setItem("skynetuuid", newskynetuuid);
                    window.localStorage.setItem("skynettoken", newskynettoken);
                    window.localStorage.setItem('loggedin', true);
                }else if(invalidLogin || ( !newskynetuuid && !newskynettoken )){
                    console.log('No Credentials', JSON.stringify([newskynetuuid, newskynettoken]));
                    window.location = 'error.html';
                    window.location = 'error.html';
                    return;
                }else{
                    console.log('No Credentials', JSON.stringify([newskynetuuid, newskynettoken]));
                    window.location = 'error.html';
                    return;
                }
                window.location = 'index.html#!/';
            })();


        </script>
    </head>
    <body>
    </body>
</html>
